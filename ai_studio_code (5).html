<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Brawl Stars Tournament - lowafgg</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        /* –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –®–†–ò–§–¢–û–í */
        @font-face {
            font-family: 'Nougat Extra Black';
            src: url('Nougat-ExtraBlack.ttf') format('truetype');
            font-weight: normal; font-style: normal;
        }
        @font-face {
            font-family: 'Pusia Bold';
            src: url('Pusia-Bold.ttf') format('truetype');
            font-weight: bold; font-style: normal;
        }

        :root {
            --bs-yellow: #ffcb05;
            --bs-blue: #0072ce;
            --bs-red: #e62429;
            --header-font: 'Nougat Extra Black', 'Arial Black', sans-serif;
            --main-font: 'Pusia Bold', 'Arial', sans-serif;
        }

        body {
            font-family: var(--main-font);
            background: radial-gradient(circle, #2c3e50 0%, #000000 100%);
            color: white;
            margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* –®–ê–ü–ö–ê */
        .header {
            width: 100%;
            background: linear-gradient(180deg, var(--bs-blue) 0%, #004a8d 100%);
            padding: 15px 0;
            border-bottom: 5px solid #000;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            z-index: 10;
        }

        .logo { width: 60px; filter: drop-shadow(2px 2px 0px #000); }
        
        .tournament-title {
            font-family: var(--header-font);
            font-size: 26px;
            color: var(--bs-yellow);
            text-transform: uppercase;
            -webkit-text-stroke: 1.2px black;
            text-shadow: 3px 3px 0px #000;
            margin-top: 5px;
        }

        /* –°–¢–ê–¢–ò–°–¢–ò–ö–ê */
        .user-stats {
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid var(--bs-yellow);
            border-radius: 15px;
            padding: 8px 20px;
            margin: 15px 0;
            display: flex; gap: 15px;
            font-size: 14px;
            box-shadow: 0 4px 0px #000;
        }
        .stat-item span { color: var(--bs-yellow); }

        /* –í–ò–î–ï–û –ü–õ–ï–ï–† */
        .video-box {
            width: 92%;
            max-width: 500px;
            border: 4px solid #000;
            border-radius: 15px;
            overflow: hidden;
            background: #000;
            aspect-ratio: 16/9;
            box-shadow: 0 8px 20px rgba(0,0,0,0.8);
        }

        /* –ö–ù–û–ü–ö–ò –ü–õ–ê–¢–§–û–†–ú */
        .tabs { display: flex; gap: 10px; margin: 15px 0; }
        .tab-btn {
            font-family: var(--main-font);
            padding: 8px 15px;
            border: 3px solid #000;
            border-radius: 10px;
            color: white;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 0 3px 0 #000;
            font-size: 12px;
        }
        .t-twitch { background: #6441a5; }
        .t-vk { background: #0077ff; }

        /* –ü–ê–ù–ï–õ–¨ –°–¢–ê–í–û–ö */
        .bet-card {
            width: 85%;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid rgba(255,255,255,0.2);
            border-radius: 25px;
            padding: 20px;
            margin-top: 10px;
            text-align: center;
            position: relative;
            transition: transform 0.6s cubic-bezier(0.6, -0.28, 0.735, 0.045), opacity 0.5s ease;
            margin-bottom: 40px;
        }

        .bet-title {
            font-family: var(--header-font);
            font-size: 20px;
            margin-bottom: 15px;
            color: #fff;
            -webkit-text-stroke: 1px black;
            transition: all 0.4s ease;
        }

        .btn-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            transition: all 0.4s ease;
        }

        .team-btn {
            font-family: var(--main-font);
            font-size: 16px;
            padding: 15px 5px;
            border: 4px solid #000;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            box-shadow: 0 5px 0 #000;
            text-transform: uppercase;
            transition: transform 0.1s;
        }
        .team-btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #000; }
        .blue { background: linear-gradient(180deg, #3498db 0%, #2980b9 100%); }
        .red { background: linear-gradient(180deg, #e74c3c 0%, #c0392b 100%); }

        /* –ê–ù–ò–ú–ê–¶–ò–û–ù–ù–´–ï –ö–õ–ê–°–°–´ */
        .hide-down {
            transform: translateY(100px);
            opacity: 0;
            pointer-events: none;
        }

        #thanks-msg {
            display: none;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.5);
            width: 100%;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        #thanks-msg.show {
            display: block;
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.1);
        }

        .thanks-text {
            font-family: var(--header-font);
            font-size: 30px;
            color: var(--bs-yellow);
            -webkit-text-stroke: 1.5px black;
            text-shadow: 3px 3px 0px #000;
        }

        .card-slide-out {
            transform: translateY(600px) rotate(5deg);
            opacity: 0;
        }

    </style>
</head>
<body>

    <div class="header">
        <img src="https://cdn-icons-png.flaticon.com/512/5883/5883011.png" class="logo">
        <div class="tournament-title">Brawl Tournament</div>
    </div>

    <div class="user-stats">
        <div class="stat-item">–ò–ì–†–û–ö: <span id="p-name">–ì–û–°–¢–¨</span></div>
        <div class="stat-item">üèÜ –ü–û–ë–ï–î–´: <span id="p-wins">0</span></div>
    </div>

    <div class="video-box" id="player-container">
        <!-- –°—é–¥–∞ –≤—Å—Ç–∞–≤–∏—Ç—Å—è iframe -->
    </div>

    <div class="tabs">
        <button class="tab-btn t-twitch" onclick="loadStream('twitch')">Twitch (lowafgg)</button>
        <button class="tab-btn t-vk" onclick="loadStream('vk')">VK Video</button>
    </div>

    <div class="bet-card" id="main-card">
        <div id="bet-ui">
            <div class="bet-title" id="ui-title">–ö–¢–û –ü–û–ë–ï–î–ò–¢?</div>
            <div class="btn-grid" id="ui-buttons">
                <button class="team-btn blue" onclick="placeBet('BLUE TEAM')">BLUE TEAM</button>
                <button class="team-btn red" onclick="placeBet('RED TEAM')">RED TEAM</button>
            </div>
        </div>

        <div id="thanks-msg">
            <div class="thanks-text">–°–ü–ê–°–ò–ë–û!</div>
            <div style="font-size: 14px; margin-top: 5px; font-family: 'Pusia Bold';">–°–¢–ê–í–ö–ê –ü–†–ò–ù–Ø–¢–ê</div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const SCRIPT_URL = "–¢–í–û–ô_URL_GOOGLE_APPS_SCRIPT"; // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ—é —Å—Å—ã–ª–∫—É –∏–∑ Google Sheets
        const TWITCH_CHANNEL = "lowafgg";
        const VK_VIDEO_URL = "https://vk.com/video_ext.php?oid=-30666667&id=456275469&hd=2"; // –ó–∞–º–µ–Ω–∏ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—É—é
        
        tg.expand();
        tg.headerColor = "#0072ce";

        // 1. –õ–û–ì–ò–ö–ê –°–¢–†–ò–ú–ê
        function loadStream(type) {
            const container = document.getElementById('player-container');
            // –í–∞–∂–Ω–æ: parent –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ–º–µ–Ω–æ–º –±–µ–∑ https://
            const domain = window.location.hostname || "localhost";
            
            if(type === 'twitch') {
                container.innerHTML = `<iframe src="https://player.twitch.tv/?channel=${TWITCH_CHANNEL}&parent=${domain}" width="100%" height="100%" frameborder="0" allowfullscreen="true"></iframe>`;
            } else {
                container.innerHTML = `<iframe src="${VK_VIDEO_URL}" width="100%" height="100%" frameborder="0" allowfullscreen="true"></iframe>`;
            }
        }

        // 2. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ò
        function initUser() {
            if(tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                document.getElementById('p-name').innerText = user.first_name.toUpperCase();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–±–µ–¥—ã –∏–∑ Google –¢–∞–±–ª–∏—Ü—ã
                if (SCRIPT_URL !== "–¢–í–û–ô_URL_GOOGLE_APPS_SCRIPT") {
                    fetch(`${SCRIPT_URL}?userId=${user.id}`)
                        .then(r => r.json())
                        .then(data => { document.getElementById('p-wins').innerText = data.wins || 0; })
                        .catch(e => console.log("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"));
                }
            }
        }

        // 3. –õ–û–ì–ò–ö–ê –°–¢–ê–í–ö–ò –ò –ê–ù–ò–ú–ê–¶–ò–ò
        function placeBet(team) {
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('heavy');
            
            // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
            const startAnimation = () => {
                // –ê–ù–ò–ú–ê–¶–ò–Ø 1: –ö–Ω–æ–ø–∫–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —É–ª–µ—Ç–∞—é—Ç –≤–Ω–∏–∑
                document.getElementById('ui-title').classList.add('hide-down');
                document.getElementById('ui-buttons').classList.add('hide-down');

                // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä (Google Sheets)
                if (tg.initDataUnsafe.user && SCRIPT_URL !== "–¢–í–û–ô_URL_GOOGLE_APPS_SCRIPT") {
                    fetch(SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify({ userId: tg.initDataUnsafe.user.id, team: team })
                    });
                }

                // –ê–ù–ò–ú–ê–¶–ò–Ø 2: –ß–µ—Ä–µ–∑ 400–º—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –°–ü–ê–°–ò–ë–û
                setTimeout(() => {
                    document.getElementById('thanks-msg').classList.add('show');
                    if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                }, 400);

                // –ê–ù–ò–ú–ê–¶–ò–Ø 3: –ß–µ—Ä–µ–∑ 2.5 —Å–µ–∫—É–Ω–¥—ã –≤—Å—è –ø–∞–Ω–µ–ª—å —É–µ–∑–∂–∞–µ—Ç –≤–Ω–∏–∑
                setTimeout(() => {
                    document.getElementById('main-card').classList.add('card-slide-out');
                }, 2500);

                // –ü–æ–ª–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 3.1 —Å–µ–∫
                setTimeout(() => {
                    document.getElementById('main-card').style.display = 'none';
                }, 3100);
            };

            // –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤ Telegram –º—ã –∏–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
            if (tg.initDataUnsafe && tg.initDataUnsafe.query_id) {
                tg.showConfirm(`–ü–û–î–¢–í–ï–†–ñ–î–ê–ï–®–¨ –°–¢–ê–í–ö–£ –ù–ê ${team}?`, (ok) => {
                    if(ok) startAnimation();
                });
            } else {
                if(confirm(`–¢–ï–°–¢: –ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ ${team}?`)) startAnimation();
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        loadStream('twitch');
        initUser();
    </script>
</body>
</html>